<div class="col-12 app--details--wrapper profile--right--wrapper">
        <div class="card">
            <div class="card-header pb-0">
                <div class="col-12 d-flex align-items-center">
                    <button mat-stroked-button color="primary" class="me-3 back--btn" (click)="navigateToappointmentDetails('/cases','')">
                        <mat-icon class="material-symbols-outlined flex-shrink-0 m-0"> keyboard_backspace </mat-icon> 
                    </button>
                    <h3 class="mb-0 clr--1F2F3E fw-600">Case Details</h3>
                    
                </div> 
            </div>
            <div class="card-body d-flex flex-column flex-sm-row " *ngIf="appointment_flag"> 
              
                <div class="profile--right d-flex flex-column w-100">
                    <div class="w-100 mb-0"> 
                        <mat-accordion class="appointment-information-header-wrapper">
                            <mat-expansion-panel class="exp-class" expanded="true">
                                <mat-expansion-panel-header>
                                    <mat-panel-title class="text-primary clr--31B7B7 font-18 fw-600" (click)="$event.stopPropagation();">
                                        Basic Information 
                                        <span class="font-14 fw-400 ml-3 badge" *ngIf="isBillingDetailsData && billingDetailsData?.inCollection=='Yes'">
                                            This Case is in collections
                                        </span>
                                        <span class="font-14 fw-600 ms-auto" *ngIf="isSelfPay">User Selected the Self Pay Option</span>
                                    </mat-panel-title>
                                    <mat-panel-description class="align-items-center" (click)="$event.stopPropagation();">
                                        <button mat-stroked-button color="primary"  (click)="navigateToappointmentDetails('/patients/patient-profile/',appointmentData?.patientId._id)">View Patient Profile</button>
                                        <!-- <button mat-stroked-button color="primary" (click)="systemFollowup()" >Appointment Reminders</button> -->
                                        <button  mat-raised-button color="primary" class="intake-btn" [disabled]="!isBillingDetailsData || isSelfPay" [routerLink]="['/support-team/case-details/billing-details',appointmentId]">View Billing Details</button>
                                        <button mat-raised-button color="primary" class="intake-btn" [disabled]="!appointmentData?.intakeFormSubmit" (click)="navigateToappointmentDetails('/intake-form/step-1/',appointmentId)">
                                            View Intake Form
                                        </button>
                                    </mat-panel-description>                                   
                                </mat-expansion-panel-header>
                                <span class="font-14 fw-400 ml-3 badge pull-right" *ngIf="!appointmentData?.intakeFormSubmit">Patient hasn't filled in the Intake Form yet</span>
                                <div class="col-12">    
                                    <div class="col-12 mt-2">
                                        <div class="d-flex flex-wrap justify-content-between align-items-baseline w-100">
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-4">
                                                <div class="w-100 mb-2">
                                                    <div class="d-flex flex-row   align-items-center profile--img--box">
                                                        <div class="img--box flex-shrink-0">
                                                            <img src="{{profileImage}}" alt="profileImage" class="img-fluid" />
                                                        </div>
                                                        <div class="d-flex flex-column">
                                                            <h3 class="mb-1 clr--1F2F3E font-18 fw-700">{{appointmentData?.patientId.firstName }} {{appointmentData?.patientId.lastName}}</h3>
                                                            <div class="mb-1 mt-1 d-flex align-items-center">
                                                                <mat-icon class="material-symbols-outlined flex-shrink-0 text-primary me-2">mail </mat-icon>
                                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 wb-ba">{{appointmentData?.patientId.email }}</p>
                                                            </div>
                                                            <div class="mb-1 d-flex align-items-center">
                                                                <mat-icon class="material-symbols-outlined flex-shrink-0 text-primary me-2">call </mat-icon>
                                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 wb-ba">+1 {{appointmentData?.patientId.phoneNumber}}</p>
                                                            </div>
                                        
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-2">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Practice Location</h3>
                                                <p class="mb-1 clr--1F2F3E  font-16 fw-400 ">{{appointmentData?.practiceLocation}}</p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-2">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Visit Number</h3>
                                                <p class="mb-1 clr--1F2F3E  font-16 fw-400"> {{patientCheckInCount}} </p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-3">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Appointment Date and Time</h3>
                                                <p class="mb-1 clr--1F2F3E font-16  wb-ba-field fw-400 ">Preferred: {{appointmentData?.appointmentDate | date:'mediumDate' }}</p>
                                                <p class="mb-1 clr--1F2F3E font-16 fw-400 ">Final: Please Schedule</p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-md-12 col-lg-6 col-xl-1">
                                                <button mat-stroked-button color="primary" class="mt-3" >
                                                    <mat-icon class="material-symbols-outlined flex-shrink-0 me-1 " > calendar_today </mat-icon>  Schedule</button>
                                            </div>
                                        </div>
                                    </div>
                                    
                                    <div class="row w-100 gx-0">
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-2 mb-2">
                                            <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Payment Mode</h3>
                                            <p class="mb-0 clr--1F2F3E font-16 fw-400 ">{{appointmentData?.payVia}}</p>
                                        </div>
                                        <!-- <div class="col-12 col-sm-6 col-lg-5 col-xl-5 mb-1">
                                            <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Medicare Therapy Threshold</h3>
                                            <p class="mb-0 clr--1F2F3E font-16 fw-400 ">OT $200 Used out of $1000,
                                                PT/SLP $350 Used out of $1200</p>
                                        </div> -->
                                        <div class="col-12 col-sm-12 col-lg-3 col-xl-2 mb-2">
                                            <mat-checkbox class=" " [(ngModel)]="isPatientCheckedIn" (change)="patientCheckIn($event)">Patient Checked-in</mat-checkbox>
                                        </div>
                                    </div>
                                
                                    <div class="col-12 mt-2">
                                        <div class="d-flex flex-row flex-wrap">
                                            <div class="col-12 col-sm-12 col-lg-4 col-xl-2 mb-2">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Referred By</h3>
                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 ">{{ appointmentData && appointmentData?.doctorId ? appointmentData?.doctorId?.name : 'NA'}}</p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-lg-4 col-xl-2 mb-2">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">POC Dates</h3>
                                                <!-- <p class="mb-0 clr--1F2F3E font-16 fw-400 ">12/1/24 - 12/10/2024</p> -->
                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 ">
                                                    <span *ngIf="hasInitialExamPlanData"> {{initialExamPlanData.plan_start_date | date: 'MM/dd/yyyy'}} - {{initialExamPlanData.plan_end_date | date: 'MM/dd/yyyy'}} </span>
                                                    <span *ngIf="!hasInitialExamPlanData"> NA </span>
                                                </p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-lg-4 col-xl-3 mb-2">
                                                <h3 class="mb-1 clr--1F2F3E font-16 fw-700">Authorization</h3>
                                                <!-- <p class="mb-0 clr--1F2F3E font-16 fw-400 ">1 of 12 visits, expires 12/1/24</p> -->
                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 ">{{isBillingDetailsData? +patientCheckInCount +' of '+ authVisits+' visits, expires '+authExpireDate :'NA'}}</p>
                                            </div>
                                            <div class="col-12 col-sm-12 col-lg-4 col-xl-5 mb-2">
                                                <div class="form-group d-flex align-items-center">
                                                    <label class="col-form-label fw-700 font-16 p-0 me-3 label--width flex-shrink-0">Hard Cap/ Soft Cap</label>
                                                    <input class="form-control form-control-md max-width-box" type="text" placeholder="" value="{{billingDetailsData?.PI_hardSoftCapText}}" disabled/>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
    
                                <form class="row" [formGroup]="stCaseDetailsForm">  
                                    <div class="col-12 mt-2">
                                        <div class="d-flex flex-row flex-wrap last--col">
                                            <div class="col mb-2 form-group"> 
                                                <div class="select-info">
                                                    <label class="col-form-label fw-600">Assign Therapist <span class="clr--DF0404 ms-1"> * </span></label>
                                                    <select class="form-select form-control" aria-label="Default select example" [(ngModel)]="selectedTherapistId" formControlName="therapistId">
                                                        <!-- <option selected>Select Therapist</option> 
                                                        <option value="1">Elizabeth</option>
                                                        <option value="2">Elizabeth 2</option>  -->
                                                        <option value="" selected>Select Therapist</option>
                                                        <option *ngFor="let therapist of therapistList" [value]="therapist.id">{{ therapist.name }}</option>
                                                    </select>
                                                    <div class="text text-danger mt-1" *ngIf="stCaseDetailsForm.controls['therapistId'].touched && stCaseDetailsForm.controls['therapistId'].hasError('required')">
                                                        {{ validationMessages.required('Therapist') }}
                                                    </div>
                                                </div>
                                            </div>
                                            <div class="col  mb-2  ">
                                                <div class="form-group">
                                                    <label class="col-form-label fw-600">Case Name</label>
                                                    <input class="form-control form-control-md max-width-box" type="text" placeholder="Search Case Name" value="{{appointmentData?.caseName}}"  disabled/>
                                                    <!-- <div class="text text-danger mt-1">Error here</div> -->
                                                </div>
                                            </div>

                                            <div class="col  mb-2 form-group">
                                                <div class="doctor-filed">
                                                    <label class="col-form-label fw-600">Return to Doctor </label>                                                   
                                                    <mat-form-field class="w-100 am--datepicker" appearance="outline">
                                                        <input matInput [matDatepicker]="picker" placeholder="From Date" (focus)="picker.open()" [min]="appointmentData?.appointmentDate" formControlName="returnToDoctor">
                                                        <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                                        <mat-datepicker #picker></mat-datepicker>
                                                    </mat-form-field>
                                                    <!-- <div class="text text-danger mt-1"> Middle Last required</div> -->
                                                </div>
                                            </div>                         

                                           
                                            <div class="col  mb-2">
                                                <div class="form-group">
                                                    <label class="col-form-label fw-600">Copay Amount</label>
                                                    <div class="input-group prefix--field max-width-box-c">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">$</span>
                                                        </div>
                                                        <input type="text" class="form-control form-control-md"value="{{isBillingDetailsData && billingDetailsData?.PI_copayAmt? billingDetailsData?.PI_copayAmt:'NA'}}"  disabled>
                                                    </div>  
                                                    <!-- <div class="text text-danger mt-1">Error here</div> -->
                                                </div>
                                            </div>
 

                                            <div class="col mb-2">
                                                <div class="form-group"> 
                                                    <label class="col-form-label fw-600">High Deductibles</label>
                                                    <div class="input-group prefix--field max-width-box-c">
                                                        <div class="input-group-prepend">
                                                            <span class="input-group-text" id="basic-addon1">$</span>
                                                        </div>
                                                        <input type="text" class="form-control form-control-md" value="{{isBillingDetailsData && billingDetailsData?.PI_highDeductible ? billingDetailsData?.PI_highDeductible :'NA'}}" disabled>
                                                    </div>  
                                                    <!-- <div class="text text-danger mt-1">Error here</div> -->
                                                </div> 
                                            </div>
 

                                            <div class="col mb-2">
                                                <div class="form-group select-info">
                                                    <label class="col-form-label fw-600">Primary Insurance</label>
                                                     <div class="d-flex w-100 position-relative">
                                                        <input class="form-control form-control-md cust--w" type="text" placeholder="Primary Insurance"  formControlName="primaryInsurance"/>
                                                      
                                                     </div>
                                                </div>
                                            </div>

                                            <div class="col-12  mb-2">
                                                <div class="form-group d-flex justify-content-end"> 
                                                    <button mat-raised-button color="primary" class=" " (click)="selectInsuranceModal()">
                                                        Update
                                                    </button>
                                                    <button mat-stroked-button color="primary" class="me-3 ms-2" [disabled]="!stCaseDetailsForm.valid" (click)="saveStCaseDetails()">
                                                        Save
                                                    </button>
                                                </div> 
                                            </div>
                                           


                                        </div>
                                    </div>
                                 </form>   

                                    <!-- <div class="col-12 mt-1 mb-3">
                                        <div class="d-flex align-items-center justify-content-end w-100 footer--btns"> 
                                           <button mat-raised-button color="primary" >
                                                Save
                                            </button> 
                                        </div>
                                    </div> -->
    
                                </div>
                            </mat-expansion-panel>
                        </mat-accordion>
                    </div>
                </div>
            </div>

            <!-- <div class="card-body d-flex flex-column flex-sm-row" >  
                <div class=" d-flex flex-column w-100 share-point-wrapper">
                    <div class="w-100 mb-0 exp-class"> 
                                <div class="col-12">  
                                    <div class="col-12">
                                        <div class="d-flex flex-row flex-wrap align-items-baseline mt-3" *ngIf="!showShare"> 
                                                 <p class="mb-0 clr--1F2F3E font-16 fw-400 me-3">Share Case Details with Billing Team</p>
                                                 <button mat-raised-button color="primary" class="m-1 " (click)="shareModal()"  >
                                                    Share
                                                </button> 
                                        </div>

                                            <div class="d-flex flex-row flex-wrap   mt-3"  *ngIf="showShare"> 
                                                <img class="green-icon" src="assets/images/ark/green-check-icon.svg" alt="" width="20px">
                                                <p class="mb-0 clr--1F2F3E font-16 fw-400 me-3 mt-2">Details are shared with Billing Team </p> 
                                                 </div>


                                    </div> 
                                </div> 
                    </div>
                </div>
            </div> -->

            <div class="card-body mt-2">
                <div class="row">
                    <div class="col-12">
                        <h3 class="mb-2 clr--1F2F3E fw-600 font-22">Notes</h3>
                    </div>
                    <div class="col-12 mb-2">
                        <div class="d-flex notes--table w-100 mt-2 mb-2">
                            <div class="row w-100">
                                <div class="col-12 mt-2">
                                    <div class="row">
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                                            <div class="form-group position-relative w-100">
                                                <input type="text" class="form-control search--outer" placeholder="Search " (keyup)="searchRecords()" [(ngModel)]="searchValue">
                                                <button mat-button class="p-0 flex-shrink-0 min-width-unset search--fields">
                                                    <mat-icon class="material-symbols-outlined flex-shrink-0">search </mat-icon>
                                                </button>
                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                                            <div class="form-group">
                                                <select class="form-select form-control" aria-label="select status" (change)="searchRecords()" [(ngModel)]="status">
                                                    <option value = "">Filter by Status</option> 
                                                    <option value="Draft">Draft</option>
                                                    <option value="Finalized">Finalized</option> 
                                                    <option value="Pending">Pending</option> 
                                                    <option value="Declined">Declined</option> 
                                                </select>
                                                <!-- <div class="text text-danger mt-1"> Middle Last required</div> -->
                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                                            <div class="form-group">
                                                <mat-form-field class="w-100 am--datepicker" appearance="outline">
                                                    <input matInput [matDatepicker]="picker" placeholder="From Date" (focus)="picker.open()" [(ngModel)]="fromDate" (dateChange)="onDateChange()">
                                                    <mat-datepicker-toggle matIconSuffix [for]="picker"></mat-datepicker-toggle>
                                                    <mat-datepicker #picker></mat-datepicker>
                                                </mat-form-field>
                                                <!-- <div class="text text-danger mt-1"> Middle Last required</div> -->
                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-2">
                                            <div class="form-group">
                                                <mat-form-field class="w-100 am--datepicker" appearance="outline">
                                                    <input matInput [matDatepicker]="picker1" placeholder="To Date" (focus)="picker1.open()" [(ngModel)]="toDate" (dateChange)="onDateChange()">
                                                    <mat-datepicker-toggle matIconSuffix [for]="picker1"></mat-datepicker-toggle>
                                                    <mat-datepicker #picker1></mat-datepicker>
                                                </mat-form-field>
                                                <!-- <div class="text text-danger mt-1"> Middle Last required</div> -->
                                            </div>
                                        </div>
                                        <div class="col-12 col-sm-6 col-lg-4 col-xl-3">
                                            <div class="form-group">
                                                <select class="form-select form-control" aria-placeholder="select Case" aria-label="select Case" (change)="searchRecords()" [(ngModel)]="caseType">
                                                    <option value = "">Filter by Note Type</option>
                                                    <option value="initial_examination">Initial Examination</option>
                                                    <option value="daily_note">Daily Note</option>
                                                    <option value="progress_note">Progress Note</option>
                                                    <option value="discharge_note">Discharge Note</option>
                                                </select>
                                                <!-- <div class="text text-danger mt-1"> Middle Last required</div> -->
                                            </div>
                                        </div>
                                        
                                    </div>
                                </div>
                                <div class="col-12 cust--mat--table--wrapper">
                                    <table mat-table [dataSource]="dataSource" matSort (matSortChange)="announceSortChange($event)"
                                        class="cust--mat--table ">  
                                        <ng-container matColumnDef="soap_note_type">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by number" class="width-textArea">
                                                Note
                                            </th>
                                            <td mat-cell *matCellDef="let element" class="width-textArea"> 
                                                <div class="d-flex align-items-center  "> 
                                                    <div> 
                                                        <p class="mb-0 font-14 text-primary clr--1F2F3E fw-500">{{element.soap_note_type}}</p>
                                                   </div>
                                                </div>     
                                            </td>
                                        </ng-container>  
                                        <ng-container matColumnDef=" note_date">
                                            <th mat-header-cell *matHeaderCellDef>
                                                Date of Service
                                            </th>
                                            <td mat-cell *matCellDef="let element"> 
                                                {{element.note_date | date: 'EEE, MMM d, y hh:mm a'}}  
                                                <!-- <p class="mt-1 "> <span class="fw-700"> Addendum:</span> Fri, Nov 09, 2023 10:00 am</p> -->
                                            </td>
                                        </ng-container> 
                                        <ng-container matColumnDef="createdBy">
                                            <th mat-header-cell *matHeaderCellDef mat-sort-header sortActionDescription="Sort by symbol">
                                                Note Added By
                                            </th>
                                            <td mat-cell *matCellDef="let element">  
                                                {{element.userObj[0].firstName}} {{element.userObj[0].lastName}}
                                                <!-- <p class="mt-1 "> Taylor Stafford</p> -->
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="status">
                                            <th mat-header-cell *matHeaderCellDef>
                                                Status
                                            </th>
                                            <td mat-cell *matCellDef="let element">
                                                {{element.status}}
                                            </td>
                                        </ng-container>
                                        <ng-container matColumnDef="action">
                                            <th mat-header-cell *matHeaderCellDef>
                                                Actions
                                            </th>
                                            <td mat-cell *matCellDef="let element">  
                                                <div class="w-100 d-flex align-items-center">
                                                    <button mat-button class="flex-shrink-0 min-width-unset" matTooltip="View Note" matTooltipPosition="above">
                                                        <mat-icon class="material-symbols-outlined flex-shrink-0 m-0 text-primary">visibility </mat-icon>
                                                    </button>  
                                                </div>
                                            </td>
                                        </ng-container>
                    
                                        <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
                                        <tr mat-row *matRowDef="let row; columns: displayedColumns;"></tr>
                                    </table>
                                    <div *ngIf="noteList.length==0 && !dataLoading" class="no--record--found d-flex align-items-center justify-content-center w-100" >
                                        <div class="d-flex flex-column align-items-center w-100">
                                            <img src="assets/images/ark/sad.png" alt="" class="mb-3 sad--img">
                                            <p class="">No Records found</p>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <mat-paginator [pageSizeOptions]="[5, 10, 20]" showFirstLastButtons aria-label="Select page of periodic elements">
                        </mat-paginator>
                    </div>
                </div>
            </div> 
        </div>
</div> 
        